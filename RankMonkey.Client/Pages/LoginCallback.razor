@page "/authentication/login-callback"

@using RankMonkey.Client.Services
@using RankMonkey.Client.Auth
@inject NavigationManager NavigationManager
@inject ILocalStorageService LocalStorage
@inject CustomAuthStateProvider AuthStateProvider

@code {
    protected override async Task OnInitializedAsync()
    {
        var uri = NavigationManager.ToAbsoluteUri(NavigationManager.Uri);
        var token = System.Web.HttpUtility.ParseQueryString(uri.Query).Get("token");

        if (!string.IsNullOrEmpty(token))
        {
            await LocalStorage.SetItemAsync("authToken", token);
            await AuthStateProvider.MarkUserAsAuthenticated(token);
        }

        NavigationManager.NavigateTo("/");
    }
}